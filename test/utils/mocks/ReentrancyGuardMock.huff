#include "../../../src/utils/ReentrancyGuard.huff"

#define function unprotectedCall()
#define function protectedCall()
#define function overprotectedCall()
#define function protectedCallWithReturnData()
#define function enterTimes() view returns (uint256)

#define constant ENTER_TIMES = FREE_STORAGE_POINTER()

#define macro UNPROTECTED_CALL() = takes (0) returns (0) {}
#define macro PROTECTED_CALL() = takes (0) returns (0) {}
#define macro OVERPROTECTED_CALL() = takes (0) returns (0) {}
#define macro PROTECTED_CALL_WITH_RETURN_DATA() = takes (0) returns (0) {}
#define macro ENTER_TIMES() = takes (0) returns (1) {}

#define macro MAIN() = takes (0) returns (0) {
    0x00 calldataload 0xE0 shr                 
    __FUNC_SIG(unprotectedCall) eq unprotected_call jumpi
    __FUNC_SIG(protectedCall) eq unprotected_call jumpi
    __FUNC_SIG(overprotectedCall) eq unprotected_call jumpi
    __FUNC_SIG(protectedCallWithReturnData) eq unprotected_call jumpi
    __FUNC_SIG(enterTimes) eq unprotected_call jumpi

    0x00 0x00 revert

    unprotected_call:
        UNPROTECTED_CALL()

    // 1st way of calling LOCK/UNLOCK
    // https://docs.huff.sh/style-guide/overview/#contract-call-return
    protectedCall:
        LOCK()
        PROTECTED_CALL()
        UNLOCK()

    overprotectedCall:
        LOCK()
        OVERPROTECTED_CALL()
        UNLOCK()

    // 2nd way of calling LOCK/UNLOCK when you need to return data
    protectedCallWithReturnData:
        LOCK()
        PROTECTED_CALL_WITH_RETURN_DATA()
        finish jump

    enterTimes:
        ENTER_TIMES()

    finish:
        UNLOCK()
        return
}